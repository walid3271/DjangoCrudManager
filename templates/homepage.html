<!-- homepage.html -->
<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Users</title>
    {% comment %}
    <link rel="stylesheet" type="text/css" href="{% static 'home.css' %}" />
    {% endcomment %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>
    <style>
      /* Full height for the body and html */
      html,
      body {
        height: 100%;
        margin: 0;
        display: flex;
        flex-direction: column;
        background-color: #f4f4f4; /* Light background color for contrast */
      }

      /* Container for centering the content */
      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        height: 100%;
        padding: 20px;
      }

      /* Style for user list */
      #user_list {
        border: 1px solid #ccc; /* Add border to the user list div */
        padding: 20px;
        border-radius: 5px;
        flex: 0 0 50%; /* Occupy half of the vertical space */
        width: 100%; /* Full width */
        overflow-y: auto; /* Enable scrolling if content overflows */
        margin-bottom: 20px; /* Space below the table */
        background-color: white; /* White background for better visibility */
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Shadow for depth */
        position: relative; /* Positioning context for pseudo-element */
      }

      /* Add side borders */
      #user_list::before,
      #user_list::after {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        width: 5px; /* Width of the side borders */
        background-color: #007bff; /* Border color */
      }

      #user_list::before {
        left: -5px; /* Position left border */
      }

      #user_list::after {
        right: -5px; /* Position right border */
      }

      table {
        width: 100%;
        border-collapse: collapse; /* Collapses table borders */
      }

      th,
      td {
        border: 1px solid #ccc; /* Add border to table cells */
        padding: 10px;
        text-align: left;
      }

      th {
        background-color: #f2f2f2; /* Background color for table header */
      }

      #add_user_button {
        float: right; /* Align the button to the right */
        margin-bottom: 10px; /* Space below the button */
      }

      /* Styles for the forms */
      .user-form {
        border: 1px solid #ccc; /* Border for forms */
        padding: 20px; /* Padding inside the form */
        margin-top: 20px; /* Margin for spacing */
        border-radius: 5px; /* Rounded corners */
        background-color: #f9f9f9; /* Light background for forms */
        display: none; /* Hidden by default */
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Shadow for depth */
        width: 100%; /* Full width */
      }
    </style>

    <div class="container">
      <!-- User List -->
      <h1>Users</h1>
      <div id="user_list">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Textbox</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in data %}
            <tr>
              <td>{{ user.name }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.textbox }}</td>
              <td>
                <button class="delete-btn" data-id="{{ user.id }}">
                  Delete
                </button>
                <button
                  class="edit-btn"
                  data-id="{{ user.id }}"
                  data-name="{{ user.name }}"
                  data-email="{{ user.email }}"
                  data-password="{{ user.password }}"
                  data-textbox="{{ user.textbox }}"
                >
                  Edit
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <!-- Add User Button -->
        <button id="add_user_button">Add User</button>
      </div>

      <!-- Add User Form -->
      <div id="add_user_section" class="user-form">
        <h2>Add User</h2>
        <form id="add_user_form" method="post">
          {% csrf_token %} {{ add_form.as_p }}
          <button type="submit">Add User</button>
        </form>
      </div>

      <!-- Update User Form -->
      <div id="update_form_section" class="user-form">
        <h2>Update User</h2>
        <form id="update_user_form" method="post">
          {% csrf_token %}
          <input type="hidden" name="user_id" id="update_user_id" />
          {{ update_form.as_p }}
          <button type="submit">Update User</button>
        </form>
      </div>
    </div>

    <script>
      // Toggle Add User Form
      $("#add_user_button").on("click", function () {
        $("#add_user_section").toggle(); // Toggle visibility of the add user section
        $("#update_form_section").hide(); // Hide the update user section if it's open
      });

      // Handle Add User
      $("#add_user_form").on("submit", function (e) {
        e.preventDefault();
        $.ajax({
          url: "{% url 'homepage' %}",
          type: "POST",
          data: $(this).serialize() + "&add_user=1",
          success: function (response) {
            alert(response.message);
            location.reload(); // Reload the page to see the updated user list
          },
          error: function (response) {
            alert("Error: " + response.responseJSON.errors);
          },
        });
      });

      // Handle Edit Button Click
      $(".edit-btn").on("click", function () {
        $("#add_user_section").hide(); // Hide the add user section if it's open
        $("#update_user_id").val($(this).data("id"));
        $("#id_name").val($(this).data("name"));
        $("#id_email").val($(this).data("email"));
        $("#id_password").val($(this).data("password"));
        $("#id_textbox").val($(this).data("textbox"));
        $("#update_form_section").show(); // Show the update form
      });

      // Handle Update User
      $("#update_user_form").on("submit", function (e) {
        e.preventDefault();
        $.ajax({
          url: "{% url 'homepage' %}",
          type: "POST",
          data: $(this).serialize() + "&update_user=1",
          success: function (response) {
            alert(response.message);
            location.reload(); // Reload the page to see the updated user list
          },
          error: function (response) {
            alert("Error: " + response.responseJSON.errors);
          },
        });
      });

      // Handle Delete User
      $(".delete-btn").on("click", function () {
        var userId = $(this).data("id");
        if (confirm("Are you sure you want to delete this user?")) {
          $.ajax({
            url: "{% url 'homepage' %}",
            type: "POST",
            data: {
              csrfmiddlewaretoken: "{{ csrf_token }}",
              user_id: userId,
              delete_user: 1,
            },
            success: function (response) {
              alert(response.message);
              location.reload(); // Reload the page to see the updated user list
            },
            error: function (response) {
              alert("Error: " + response.responseJSON.errors);
            },
          });
        }
      });
    </script>
  </body>
</html>
